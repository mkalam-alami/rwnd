config:
    gameId: redSpadeFr 
    start: 10
    persistFlags: true
    
steps: 

# First scene

    10:
        text: |
            J'arrive face au manoir. Des bruits de conversations et de vaisselle s'échappent de l'entrée.
            Un réceptionniste se tient devant la porte.
        links:
            20:
                ifNotFlag: redFollowsMe
                text: S'approcher
     
    20:
        #debug
        setFlag: redFollowsMe
        text: |
            {{^redShotMe}}{{^redFollowsMe}}Le jeune employé, rongé par l'ennui en cette fin de soirée, sourit en me voyant. Je me présente :
            « Bonsoir cher ami. Je suis attendu sous le nom de... »{{/redFollowsMe}}{{#redFollowsMe}}Le réceptionniste n'est autre que Red Spade. Il agite son arme en me narguant :
            « Tu as joué et perdu, {{#heart}}Black Heart{{/heart}}{{^heart}}Red Club{{/heart}}. Bientôt, la construction de mon arme s'achèvera, et je figerai ton pays dans le temps pour cent ans. Et tout ça grâce à ceci, » dit-il tout en brandissant une montre à gousset en tous points identique à la mienne.
            « Votre civilisation sera alors complètement dépassée, et vos anciennes technologies ne feront pas le poids lorsque je viendrai vous envahir... »
            Il éclate d'un rire mauvais.{{/redFollowsMe}}{{/redShotMe}}{{#redShotMe}}Je tâte ma poitrine machinalement, la blessure a bien disparu. C'est psychologique, mais j'ai besoin de quelques secondes pour retrouver mon souffle. J'aperçois Red qui guette toujours l'entrée du manoir.{{/redShotMe}}
        links:
            21:
                ifNotFlag: redFollowsMe
                text: Red Club
            22:
                ifNotFlag: redFollowsMe
                text: Black Heart
            23:
                text: Je ne me souviens plus
                ifNotFlag: boris
            70:
                text: Boris Rosing
                ifNotFlag: redFollowsMe
                ifFlag: boris
            400:
                ifFlag: redFollowsMe
                text: Se jeter sur lui
            410:
                ifFlag: redShotMe
                text: Le contourner par sa gauche
    
    400:
        setFlag: redShotMe
        text: |
            Pendant son discours, je me suis lentement approché de lui. Dans un effort désespéré, je me jette en avant et tente d'écarter son bras armé tout en le plaquant au sol.
            
            Malheureusement, il est le plus rapide et un coup de feu retentit.
            
            Je remarque, lors de ma chute, que son œil gauche paraît étrange... Aurait-il un œil de verre ? Je ne m'en étais jamais rendu compte jusqu'à maintenant.
            
            Je me retrouve allongé sur le sol, une douleur sourde à la poitrine. Je relève la tête vers mon torse et vois une corolle pourpre s'agrandir sur ma chemise, tandis que ma vision se fait floue... Je tente une dernière fois de me concentrer.
    
    410:
        text: Je m'applique à faire un détour silencieux, profitant de l'angle mort laissé par l'œil de verre de Red. Je me retrouve bientôt derrière lui, mon couteau à la main, et remarque dans sa poche arrière sa fameuse montre, dont la chaîne pend sur quelques centimètres.
            
        links:
            420: Neutraliser Red Spade
            
    420:
        disableRewindTo: 420
        text: |
            Dans un même mouvement, je lance l'appareil de Red Spade hors de sa portée, et l'immobilise d'une clef de bras, le couteau sous sa gorge.
            « Joli coup, » lance Red d'une voix étranglée.
            Il tend son bras libre vers sa poche arrière, réalise l'absence de sa montre et perd tout à coup de sa superbe. Je resserre un peu plus mon étreinte.
            
            Quelques minutes plus tard, je tiens enfin en main l'objet de ma mission. Une arme capable d'arrêter le temps...
            Tant de pouvoir ne doit pas risquer d'atterir entre de mauvaises mains.
            
            Je m'approche de la cheminée et lance le dossier au milieu des flammes. L'ancienne montre à gousset de Red la suit de peu, se détruisant en quelques secondes dans une gerbe d'étincelles multicolores. Je saisis alors entre mes mains ma propre montre, dernier exemplaire d'une ancienne technologie longtemps perdue.
            « Jetez-le dans le feu, » crie une voix dans ma tête. « Détruisez-le ! »
            J'hésite un instant, puis avec un sourire en coin, me détourne des flammes.
            
    21:
        removeFlag: heart
        continue: 30
    22:
        setFlag: heart
        continue: 30
    
    23:
        text: |
            « Je suis désolé Monsieur, il me faut un nom pour vous laisser entrer. »
            Simple contretemps.
        links:
            40: Sortir la vieille montre à gousset
        
    30:
        text: |
            L'employé me tourne le dos pour parcourir sa liste, puis se retourve vers moi d'un air désolé. 
            « Veuillez m'excuser, mais je ne trouve pas votre nom... »
            « Vous êtes sûr ? Vous ne trouvez pas {{#heart}}Black Heart{{/heart}}{{^heart}}Red Club{{/heart}} ? »
            « Je suis désolé M'sieur, votre nom n'est pas ici. »
            Simple contretemps.
        links:
            40: Sortir la vieille montre à gousset
    
    40:
        text: |
            « Vous voyez cette ancienne montre ? Derrière cette technologie dépassée se cache une magie incroyable. »
            Le réceptionniste paraît amusé. « Quel genre de pouvoir ? »
            « Cet appareil me permet de remonter le temps. Et par conséquent d'accéder à un savoir infini. »
            « Euh, quel lien y a-t-il entre... remonter le temps et... le savoir infini ? »
            « Peu importe, voyez plutôt : je vais deviner ce que vous avez dans votre poche intérieure droite. »
        links:
            50: Faire mine de se concentrer
            51: Murmurer des incantations
            
    50:
        continue: 51
    51: 
        disableRewindTo: 51
        text: |
            L'employé me nargue, un sourire en coin :
            « Alors ? Qu'est-ce que j'ai dans ma veste ? »
        links:
            51bis: Je sais ce que c'est !
    51bis: 
        text: « Il s'agit...  »
        links:
            52: D'un mouchoir
            54: D'un paquet de cigarattes
            53: D'un trousseau de clefs
            60:
                ifFlag: 100dollars
                text: D'un pourboire
                
    52:
        continue: 55
    53:
        continue: 55
    54:
        continue: 55
    55:
        setFlag: 100dollars
        text: |
            « Haha bien essayé ! »
            « Dommage, » fais-je avec humilité. « C'était quoi ? »
            « Vous ne valez pas grand-chose comme magicien ! C'était un pourboire de cent dollars », lance-t-il fièrement.
            « C'est tout ce que voulais savoir... »
            Sous son regard perplexe, je lève lentement ma montre à gousset, et me concentre sur un point dans le passé...
            
    60:
        setFlag: boris
        disableRewindTo: '-'
        text: |
            Je sors mon portefeuille de ma poche arrière, puis d'un geste théâtral, j'en dégaîne un billet de cent dollars.
            
            Le réceptionniste fait les grands yeux, et se retourne le temps de vérifier sa poche. J'en profite pour le contourner et m'approcher de la liste des invités. J'ai tout juste le temps de lire un nom : Boris Rosing.
            
            « Vous avez bien failli m'av— eh qu'est-ce que vous faites ? »
            Je me concentre à nouveau.
            
    70: 
        #debug
        setFlag: windowsUnlocked
        text: |
            L'employé me tourne le dos pour parcourir sa liste, puis se retourne vers moi et fait une petite courbette. 
            « Je vous souhaite la bienvenue, Monsieur Rosing. C'est un plaisir de vous avoir parmi nous ce soir. »
        links:
            100: Entrer dans le bâtiment
            300:
                ifFlag: windowsUnlocked
                text: Grimper par la fenêtre du salon
            
            
            
# Second scene
            
    100:
        text: |
            J'entre dans une grande salle luxueusment décorée, où les hommes en costume et les femmes en robe de soirée discutent par petits groupes, un verre de champagne à la main. Un buffet appétissant occupe tout un mur de la pièce.
            
            Il me faut un instant pour repérer l'escalier au fond de la salle, en partie masqué par un lustre imposant. Le bureau doit être à l'étage.
        links:
            110: Monter l'escalier
            105: Examiner les invités
    
    105:
        removeFlag: agentFollowedMe
        text: Je repère parmi la foule ce qui semble être un agent de sécurité. En faisant attention, je devrais pouvoir atteindre l'escalier sans l'attirer.
        links:
            120: Monter l'escalier

    110:
        removeFlag: hasKey
        setFlag: agentFollowedMe
        text: |
            Sans que les invités ne me prêtent attention, je me faufile entre les invités jusqu'à l'escalier du fond.
            
            Une fois parvenu à l'étage, je jette un regard sous la rembarde : quelqu'un se trouve en bas de l'escalier. J'ai l'impression d'avoir été suivi.
        links: 
            130: Examiner l'étage
            115: Redescendre confronter l'intrus
    
    115:
        text: |
            De peur d'avoir attiré l'attention, je redescends l'air de rien l'escalier... Pour me trouver face à face avec un homme froid aux épaules carrées. Je lui souris :
            « Veuillez m'excuser, je cherchais les toilettes et— »
            Avec une vitesse surprenante, le garde me plaque contre le mur, une main sur la bouche. Une douleur déchirante traverse mon ventre, et je m'apprête à perdre connaissance...
            
    120:
        removeFlag: hasKey
        text: |
            Sans que personne ne semble me prêter attention, je me faufile entre les invités jusqu'à l'escalier du fond.
            Une fois parvenu à l'étage, je jette un regard sous la rembarde : le garde ne m'a pas suivi.
        links:
            130: Examiner l'étage
            
    140:
        removeFlag: hasKey
        text: "Je retourne dans le couloir, puis m'arrête subitement : quelqu'un vient de monter l'escalier. Il me jauge d'un regard froid, puis s'approche lentement vers moi."
        links:
            145: Fuir
            146: Combattre
            
    145:
        text: |
            Je m'enferme dans la pièce la plus proche, et me retrouve dans l'obscurité. J'entends des voix à l'extérieur, je vois par-dessous la porte une lumière s'échapper et des formes s'agiter.
            « Je crois que je suis fichu, » dis-je à moi-même.
            Quelqu'un défonce bruyamment la porte d'un coup de pied et trois agents m'encerclent, armés jusqu'aux dents. Ne restons pas pour la suite.
    
    146:
        text: |
            Je sors un couteau de ma veste. Simultanément, l'agent dégaine un revolver, me met en joue et...
            D'instinct, je ferme les yeux et me concentre.
    
    130:
        text: Le couloir part à gauche et à droite, avec pas moins de trois portes de chaque côté. Je n'ai pas pu avoir les plans à l'avance, il va falloir chercher le bureau au hasard.
        longLinks: true
        links:
            salle11: 1ère salle à gauche (fermée, une voix en sort)
            salle12: 2ème salle à gauche (fermée)
            salle13: 3ème salle à gauche (entrouverte, allumée)
            salle21: 
                ifNotFlag: bathroomChecked
                text: 1ère salle à droite (fermée)
            salleopen: 
                ifFlag: bathroomChecked
                text: 1ère salle à droite (fermée)
            salle22:
                ifNotFlag: hasKey
                text: 2ème salle à droite (fermée, a une porte double)
            salleopen2:
                ifFlag: hasKey
                text: 2ème salle à droite (fermée, a une porte double)
            salle23: 3ème porte à droite (fermée, un tapis est posé devant)

    salleopen2:
        continue: salleopen
    salleopen:
        text: J'ai déjà fouillé cette pièce.
        links:
            130: Retourner dans le couloir
            
    salle11:
        text: J'entrouvre la porte avec précaution. Une radio est allumée à l'intérieur, mais personne ne s'y trouve. Une chambre de serviteur il semblerait.
        links:
            130:
                ifNotFlag: agentFollowedMe
                text: Retourner dans le couloir
            140:
                ifFlag: agentFollowedMe
                text: Retourner dans le couloir
    
    salle12:
        text: La porte s'ouvre sur un espace de rangement. Je n'y trouve rien d'intéressant.
        links:
            130:
                ifNotFlag: agentFollowedMe
                text: Retourner dans le couloir
            140:
                ifFlag: agentFollowedMe
                text: Retourner dans le couloir
                            
    salle13:
        text: Je m'approche et glisse mon regard à travers l'interstice, pour y repérer trois personnes armées, assises autour d'une table. La bonne nouvelle, c'est qu'il ne s'agit pas de la bonne pièce.
        links:
            130:
                ifNotFlag: agentFollowedMe
                text: Retourner dans le couloir
            140:
                ifFlag: agentFollowedMe
                text: Retourner dans le couloir
                
    salle21:
        text: La porte est fermée à clef. En essayant de l'ouvrir, le bruit de la porte a semblé résonner à l'intérieur.
        links:
            salle21b: Essayer de la crocheter
            salle21c:
                ifFlag: hasKey
                text: Utiliser la clef
            130:
                ifNotFlag: agentFollowedMe
                text: Retourner dans le couloir
            140:
                ifFlag: agentFollowedMe
                text: Retourner dans le couloir
            
    salle21b:
        setFlag: bathroomChecked
        text: Je sors un crochet de ma veste et ouvre rapidement la serrure. Une salle de bains.
        links:
            130:
                ifNotFlag: agentFollowedMe
                text: Retourner dans le couloir
            140:
                ifFlag: agentFollowedMe
                text: Retourner dans le couloir
        
    salle21c:
        text: La clef ne correspond pas.
        links:
            130:
                ifNotFlag: agentFollowedMe
                text: Retourner dans le couloir
            140:
                ifFlag: agentFollowedMe
                text: Retourner dans le couloir
            
                
    salle22:
        removeFlag: hasKey
        text: J'entre dans un grand salon, avec un billard à l'intérieur. Quelqu'un a laissé des clefs sur une chaise, je les ramasse en silence.
        links:
            salle22getkey:
                ifNotFlag: agentFollowedMe
                text: Retourner dans le couloir
            140:
                ifFlag: agentFollowedMe
                text: Retourner dans le couloir
    
    salle22getkey:
        setFlag: hasKey
        continue: 130
                
    salle23:
        text: La porte est fermée à clef.
        links:
            salle23b: Regarder sous le tapis
            salle23c: Essayer de la crocheter
            200:
                ifFlag: hasKey
                text: Utiliser la clef
            130:
                ifNotFlag: agentFollowedMe
                text: Retourner dans le couloir
            140:
                ifFlag: agentFollowedMe
                text: Retourner dans le couloir
    
    salle23b:
        text: Rien sous le tapis.
        links:
            salle23c: Essayer de la crocheter
            200:
                ifFlag: hasKey
                text: Utiliser la clef
            130:
                ifNotFlag: agentFollowedMe
                text: Retourner dans le couloir
            140:
                ifFlag: agentFollowedMe
                text: Retourner dans le couloir
    
    salle23c:
        text: Je sors un crochet de ma veste et tente d'ouvrir la serrure. Le modèle m'est inconnu... Il semble en fait que toute la porte ait été faite sur mesure. Je vais devoir trouver un autre moyen d'entrer.
        links:
            salle23b: Regarder sous le tapis
            200:
                ifFlag: hasKey
                text: Utiliser la clef
            130:
                ifNotFlag: agentFollowedMe
                text: Retourner dans le couloir
            140:
                ifFlag: agentFollowedMe
                text: Retourner dans le couloir

    200:
        disableRewindTo: 200
        text: |
            La clef correspond.
            
            La porte s'ouvre sur une grande salle doucement éclairée, imprégnée d'une odeur de tabac. Des livres recouvrent les murs, et un imposant bureau décoré avec élégance se trouve au fond de la pièce. Il n'y a personne dans la salle. 
        links:
            210: Fouiller la salle
            
    210:
        text: |
            A peine commencè-je mes recherches qu'un bruissement me force à me retourner : une bibliothèque s'est écartée du mur, et un homme élancé se tient dans l'encadrement, un dossier à la main.
            
            Je reconnais cette silhouette. Il s'agit de *Red Spade*, un... ancien collègue.
            
            Il s'avance dans la lumière, et rompt le silence d'un rire hautain :
            
            « Alors comme ça il t'ont envoyé ici ! Ils prennent mon business très au sérieux... »
            « C'est donc toi qui est derrière ce projet ? Je ne te laisserai pas faire, Red. »
            
            Des gardes armés entrent dans la pièce.
        links:
            215: Chercher une sortie
            216: Ne rien faire
            
    215: 
        text: Je me retourne brièvement. La fenêtre est ouverte, mais est trop haute pour tenter le plongeon.
        continue: 216
    
    216:
        disableRewindTo: '-'
        setFlag: windowsUnlocked
        text: |
            Tandis que les agents s'approchent de moi, Red Spade lève ses documents :
            
            « C'est ça que tu cherchais n'est-ce pas ? Quel dommage, tu étais si près du but ! »
            « Oh ne t'inquiète pas pour moi, » fais-je avec un sourire poli.
            
            Je devrais pouvoir revenir au bureau par un autre moyen, plus rapide. Peut-être une fenêtre ?

# Third scene

    300: 
        text: |
            {{^redFollowsMe}}Une fois trompée la vigilance du réceptionniste, je me mets à longer le mur extérieur dans l'obscurité.
            Je repère la fenêtre du salon, délace mes chaussures, puis me mets à grimper à l'aide des reliefs du mur.
            Je rejoins rapidement le bureau, dont la fenêtre est par chance toujours (...déjà ?) ouverte.{{/redFollowsMe}}{{#redFollowsMe}}Je m'écarte de l'entrée pour rejoindre la fenêtre du salon, lorsque retentit un coup de feu. Un morceau de mur éclate à quelques centimètres de moi.
            
            Je me retourne, et à la place du réceptionniste se tient un Red au sourire terrible, l'arme pointée sur moi.
            « Tu ne m'échapperas pas ! » me crie-t-il.
            
            Aurait-il le même pouvoir que moi ? Comment le combattre ? Je dois revenir plus tôt !{{/redFollowsMe}}
        links:
            305:
                ifNotFlag: redFollowsMe
                text: Fouiller le bureau
            310:
                ifNotFlag: redFollowsMe
                text: Essayer d'ouvrir le passage secret
             
    305:
        text: |
            Je n'ai que peu de temps avant que Red Spade ne surgisse à nouveau.
            Je parcours la pièce sans m'attadrer : les informations que je recherche sont derrière ce passage.
    310:
        text: |
            Je parcours mes mains sur la bibliothèque à la recherche d'une ouverture, et finis par remarquer une fente dans le fond du meuble, entre deux livres. J'y insère la pointe de mon couteau, et un déclic se fait entendre.
        links:
            320: Entrer dans le passage
            
    320:
        disableRewindTo: '-'
        setFlag: redFollowsMe
        text: |
            Le meuble cède le passage en silence. Je m'engage dans l'ouverture, et me retrouve nez-à-nez avec Red Spade.
            « Trop lent ! » s'exclame-t-il, brandissant une lame.
            Comment est-ce possible ? Je dois réessayer. Grimper plus rapidement peut-être.
