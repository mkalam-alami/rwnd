<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>red spade &spades;</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body>

<h1 id="game-title"><span class="red">red spade</span> &spades; <span class="game-title-legend">An interactive short story (~10mn)</span></h1>

<div id="rwnd-container">
</div>

<div id="footer">
<span class="pull-right">
    A <a href="http://ludumdare.com/compo/ludum-dare-36/?action=preview&uid=9172">Ludum Dare 36 entry</a>, by <a href="https://twitter.com/mkalamalami">Wan</a> (code/story) and <a href="http://ludumdare.com/compo/author/lonespelunker/">LoneSpelunker</a> (proofreading). Powered by <a href="https://github.com/mkalam-alami/rwnd">rwnd</a> (<a href="https://github.com/mkalam-alami/rwnd/tree/ld36">sources</a>).
</span>
<a href="?fr"><img src="img/fr.png"></a>
<a href="?en"><img src="img/en.png"></a>
</div>

<script id="rwnd-menu-template" type="text/template">
<div id="{{elId}}" class="rwnd-step {{#options.animate}}rwnd-hidden{{/options.animate}}">
    <div class="rwnd-text">{{{text}}}</div>
    <div class="rwnd-links">
    {{#links}}
        {{^options.linksDisabled}}
        <span id="{{linkElId}}" class="rwnd-link"
            data-rwnd-state="{{stateId}}" data-rwnd-link="{{linkId}}">[ {{{linkText}}} ]</span>
        {{/options.linksDisabled}}
        {{#options.linksDisabled}}
        <span class="rwnd-link rwnd-link-disabled">[ {{{linkText}}} ]</a> 
        {{/options.linksDisabled}}
    {{/links}}
    </div>
</div>
</script>

<script id="rwnd-footer-template" type="text/template">
<div class="rwnd-menu">
    <span id="rwnd-cancel" class="rwnd-link" style="display: inline-block">[ Cancel ]</span>
    <span id="rwnd-restart" class="rwnd-link" style="display: inline-block">[ Restart ]</span>
</div>
</script>

<script type="text/javascript" src="lib/js-yaml.min.js"></script>
<script type="text/javascript" src="lib/mustache.min.js"></script>
<script type="text/javascript" src="lib/showdown.min.js"></script>
<script type="text/javascript" src="lib/rwnd.js"></script>
<script type="text/javascript">

var fileName = (window.location.href.indexOf('?en') != -1) ? 'game.en.yaml' : 'game.fr.yaml';
rwnd.loadFile(fileName, function (game) {
    var linkCallback = game.view.callbacks['link'];
    var isHeart = false;
    game.view.setCallback('link', function(linkStateId, targetStepId) {
        if (targetStepId == 21) isHeart = false;
        if (targetStepId == 22) isHeart = true;
        if (targetStepId == 422) {
            // evil ending
            var i = 0, steps = document.getElementsByClassName('rwnd-step');
            for (var i = 0; i < 20; i++) {
                setTimeout(function() {
                    for (var id in steps) {
                        var step = steps[id];
                        if (step.innerHTML) {
                            step.textContent = step.textContent.slice(0,Math.floor(step.textContent.length * 9 / 10));
                        }
                    }
                }, i * 100);
            }
            
            setTimeout(function() {
                for (var id in steps) {
                    var step = steps[id];
                    if (step.parentElement)
                        step.parentElement.removeChild(step);
                }
            }, 1500);
            setTimeout(function() {
                document.getElementById('game-title').innerHTML = isHeart ? '<span class="red">black heart</span> &hearts;' : '<span class="red">red clubs</span> &clubs;';
                document.getElementsByTagName('title')[0].innerHTML = isHeart ? 'black heart &hearts;' : 'red clubs &clubs;';
            }, 2500);
        }
        else {
            linkCallback.callback.apply(linkCallback.context, [linkStateId, targetStepId]);
        }
    }, this);
});

</script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-26065046-3', 'auto');
ga('send', 'pageview');
</script>

</body>
</html>